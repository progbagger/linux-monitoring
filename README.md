# Linux monitoring

Эксперименты с Linux, логами и системами мониторинга.

## thrasher

Создаёт заданное количество папок и файлов в них. Останавливается, если осталось меньше 1 Gb на диске.

Пример:

```shell
# 1 - путь к папке, где мусорить (такого пути не должно существовать)
# 2 - количество подпапок
# 3 - строка допустимых символов в названиях подпапок
# 4 - количество воздаваемых файлов в каждой подпапке
# 5 - строка допустимых символов в названиях файлов
# 6 - размер создаваемого файла вида nkb (1kb - 100kb)
./main.sh aboba 50 abcdefg 50 abcdefg 75kb
```

## random_thrasher

То же, что [](#thrasher), но создаёт файлы по всей системе в тех местах, где есть права на запись и размером до 100 Мб каждый. Останавливается, если осталось меньше 1 Gb на диске.

Пример:

```shell
# 1 - строка допустимых символов в названиях подпапок
# 2 - строка допустимых символов в названиях файлов
# 3 - размер каждого файла вида nMb (1Mb - 100Mb)
./main.sh abcdefg abcdefg.abc 23Mb
```

## cleaner

Скрипт для удаления файлов по различным параметрам:

1. файл логов, сгенерированный предыдущими двумя скриптами
2. диапазон дат в формате `01.12.84 23:59 - 01.06.03 12:30`
3. маску имён

Примеры:

```shell
# по пути к логу
./main.sh ../02/created_files.log
```

```shell
# по диапазону дат
# год можно вводить как сокращённый (2 цифры), так и полный (4 цифры)
# если сокращённый год <= 30, то год будет восприниматься как 1930
./main.sh "01.12.99 23:59 - 01.06.03 12:30"
```

```shell
# по маске имени
./main.sh abcdefg_220684.abc
# данная команда удалит все файлы, а имени которых есть буквы abcdefg, которые кончаются на _220684
# и у которых расширение состоит из букв abc
```

## log_generator

Скрипт генерирует 5 файлов nginx-логов, со случайными значениями.

```shell
# создаёт папку nginx_logx, в которой будут лежать 5 файлов с логами количеством от 100 до 1000
./main.sh
```

## log_analyzer

Скрипт позволяет анализировать логи различными способами.

```shell
# 1 - путь до папки с логами
# 2 - режим работы программы
# - 1 - сортировка по кодам ответа
# - 2 - получение логов с уникальным IP-адресом
# - 3 - получение ответов с ошибками
# - 4 - получение уникальных IP-адресов из ответов с ошибками
./main.sh nginx_logs 2
```

## goaccess_log_analyzer

Скрипт для генерации HTML-страницы для анализа логов при помощи утилиты **goaccess** и анализа их в CLI.

```shell
# принимает единственный аргумент - путь к папке с логами
./main.sh nginx_logs
```

## custom_scraper

Демонстрация кастомного сбора логов в формате, понятном для **Prometheus**.

Композитор поднимает 4 контейнера, из которых:

1. **alpine** - просто собирает свои логи и кидает их в `/tmp/metrics`
2. **nginx** - "видит" эти метрики и отдаёт их по порту **3111**
3. **prometheus** - читает логи, отдаваемые **nginx** и открывает порт 9090 для **grafana**
4. **grafana** - предоставляет веб-интерфейс для создания дашбордов с метриками

Запуск:

```shell
docker-compose up
```

В **Grafana**, по адресу [](http://localhost:3000), нужно зайти в `admin` с паролем `admin`, добавить источник данных - **Prometheus**, который для контейнера открыт по адресу [](http://prometheus:9090) и создать свой дашборд.

Метрики имеют префикс `elenenode`.
